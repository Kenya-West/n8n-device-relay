{
  "version": "1.0.0",
  "tokens": [
    {
      "name": "myphone",
      "key": "<THINK_OF_A_SECRET_KEY_YOURSELF>"
    },
    {
      "name": "debug",
      "key": "<THIS_TOKEN_WITH_DEBUG_NAME_BYPASSES_DEVICE_CHECK_USE_ONLY_FOR_TESTING>"
    }
  ],
  "recipients": {
    "me": {
      "vars": {
        "botToken": "<INSERT_TELEGRAM_BOT_TOKEN>",
        "tgChatId": "<INSERT_TELEGRAM_CHAT_ID>"
      },
      "rules": [
        {
          "id": "rule_sms_received",
          "type": "sms_received",
          "when": [
            {
              "path": "device.id",
              "operator": "equals",
              "value": "myphone"
            }
          ],
          "then": {
            "endpointIds": [
              "telegram_sendMessage_post"
            ],
            "templateIds": [
              "template_sms_1_ru"
            ]
          }
        },
        {
          "id": "rule_call_received",
          "type": "call_received",
          "when": [
            {
              "path": "device.id",
              "operator": "equals",
              "value": "myphone"
            }
          ],
          "then": {
            "endpointIds": [
              "telegram_sendMessage_post"
            ],
            "templateIds": [
              "template_call_1_ru"
            ]
          }
        },
        {
          "id": "rule_wifi_connected",
          "type": "wifi_connected",
          "when": [
            {
              "path": "device.id",
              "operator": "equals",
              "value": "myphone"
            }
          ],
          "then": {
            "endpointIds": [
              "telegram_sendMessage_post"
            ],
            "templateIds": [
              "template_wifi_1_ru"
            ]
          }
        },
        {
          "id": "rule_notification_received",
          "type": "notification_received",
          "when": [
            {
              "path": "device.id",
              "operator": "equals",
              "value": "myphone"
            }
          ],
          "then": {
            "endpointIds": [
              "telegram_sendMessage_post"
            ],
            "templateIds": [
              "template_app_1_ru"
            ]
          }
        },
        {
          "id": "rule_notification_received",
          "type": "notification_received",
          "when": [
            {
              "path": "device.id",
              "operator": "equals",
              "value": "myphone"
            },
            {
              "path": "data.body",
              "operator": "matches_regex",
              "value": "(?:.+)?SOME STRING(?:.+)?"
            }
          ],
          "then": {
            "endpointIds": [
              "telegram_sendMessage_post"
            ],
            "templateIds": [
              "template_app_1_ru"
            ]
          }
        }
      ]
    }
  },
  "endpoints": {
    "telegram_sendMessage_get": {
      "method": "GET",
      "url": "https://api.telegram.org/bot{recipient.vars.botToken}/sendMessage",
      "searchParams": {
        "chat_id": "{recipient.vars.tgChatId}",
        "text": "{%text%}"
      }
    },
    "telegram_sendMessage_post": {
      "method": "POST",
      "url": "https://api.telegram.org/bot{recipient.vars.botToken}/sendMessage",
      "body": {
        "type": "json",
        "content": {
          "chat_id": "{recipient.vars.tgChatId}",
          "text": "{%text%}"
        }
      }
    }
  },
  "templates": {
    "template_sms_1_ru": {
      "text": "ðŸ“„ Ð’Ñ…Ð¾Ð´ÑÑ‰ÐµÐµ ÑÐ¼Ñ Ð¾Ñ‚: {data.fromName} (Ð½Ð¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð°: {data.fromPhoneNumber})\n\nðŸ“– Ð¢ÐµÐºÑÑ‚:\n{data.body}\n\nâ„¹ï¸ Ð”Ð¾Ð¿. Ð´Ð°Ð½Ð½Ñ‹Ðµ:\nðŸ”‹ Ð—Ð°Ñ€ÑÐ´: {device.batteryLevelPercent}%,\nðŸ“Ÿ Ð˜Ð¼Ñ SIM: {device.cellularCarrierName} (ID: {device.currentSimSlotIndex}),\nðŸ“¶ Ð¡ÐµÑ‚ÑŒ Wi-Fi: {device.currentWifiSsid}"
    },
    "template_call_1_ru": {
      "text": "ðŸ“ž Ð’Ñ…Ð¾Ð´ÑÑ‰Ð¸Ð¹ Ð·Ð²Ð¾Ð½Ð¾Ðº Ð¾Ñ‚: {data.fromName} (Ð½Ð¾Ð¼ÐµÑ€ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð°: {data.fromPhoneNumber})\n\nâ„¹ï¸ Ð”Ð¾Ð¿. Ð´Ð°Ð½Ð½Ñ‹Ðµ:\nðŸ”‹ Ð—Ð°Ñ€ÑÐ´: {device.batteryLevelPercent}%,\nðŸ“Ÿ Ð˜Ð¼Ñ SIM: {device.cellularCarrierName} (ID: {device.currentSimSlotIndex}),\nðŸ“¶ Ð¡ÐµÑ‚ÑŒ Wi-Fi: {device.currentWifiSsid}"
    },
    "template_wifi_1_ru": {
      "text": "ðŸ›œ Ð£ÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾ {device.id} Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾ Ðº ÑÐµÑ‚Ð¸ Wi-Fi!\n\nÐ¡ÐµÑ‚ÑŒ Wi-Fi: {device.currentWifiSsid}\nÐ”Ð°Ð½Ð½Ñ‹Ðµ Ð¾ Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸:\n- {device.locationPoint}\n- {device.locationLink}\n- Ð¡ÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾Ðµ Ð¼ÐµÑÑ‚Ð¾Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ: {device.locationLastTimestamp}\n- Ð¡ÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ Ð°Ð¿Ð¿Ð°Ñ€Ð°Ñ‚Ð°: {device.currentSpeed} ÐºÐ¼/Ñ‡.\n\nâ„¹ï¸ Ð”Ð¾Ð¿. Ð´Ð°Ð½Ð½Ñ‹Ðµ:\nðŸ”‹ Ð—Ð°Ñ€ÑÐ´: {device.batteryLevelPercent}%\nðŸ“± Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ ROM: {device.availableStorageBytes}\nðŸ“± Ð’ÑÐµÐ³Ð¾ ROM: {device.totalStorageBytes}"
    },
    "template_app_1_ru": {
      "text": "ðŸ”” Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ: {data.appName} ({data.packageName})\n\nðŸ“– Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº:\n{data.title}\n\nðŸ“– Ð¢ÐµÐºÑÑ‚:\n{data.body}\n\nâ„¹ï¸ Ð”Ð¾Ð¿. Ð´Ð°Ð½Ð½Ñ‹Ðµ:\nðŸ”‹ Ð—Ð°Ñ€ÑÐ´: {device.batteryLevelPercent}%"
    }
  },
  "logIngestions": {
    "logingestion_1": {
      "type": "open-telemetry",
      "rules": [
        {
          "id": "logs",
          "steps": [
            "initial",
            "send_message_after"
          ],
          "payloadIds": [
            "payload_1"
          ],
          "endpointIds": [
            "endpoint_1"
          ]
        }
      ],
      "payloads": [
        {
          "id": "payload_1",
          "body": {
            "resourceLogs": [
              {
                "resource": {
                  "attributes": [
                    {
                      "key": "service.name",
                      "value": {
                        "stringValue": "n8n-device-relay"
                      }
                    }
                  ]
                },
                "scopeLogs": [
                  {
                    "logRecords": [
                      {
                        "timeUnixNano": "{%expr=(Date.now() * 1e6).toString()%}",
                        "observedTimeUnixNano": "{%expr=(Date.now() * 1e6).toString()%}",
                        "severityNumber": 10,
                        "severityText": "Information",
                        "traceId": "{%expr=Array.from({length:32}).map(()=>Math.floor(Math.random()*16).toString(16)).join('').toUpperCase()%}",
                        "spanId": "{%expr=Array.from({length:16}).map(()=>Math.floor(Math.random()*16).toString(16)).join('').toUpperCase()%}",
                        "body": {
                          "stringValue": "{%step%}"
                        },
                        "attributes": [
                          {
                            "key": "request",
                            "value": {
                              "stringValue": "{%event%}"
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        }
      ],
      "endpoints": {
        "endpoint_1": {
          "method": "POST",
          "url": "https://<API endpoint>",
          "headers": {
            "Authorization": "<Authorization Token>"
          },
          "body": {
            "type": "json",
            "content": "{%body%}"
          }
        }
      }
    }
  }
}